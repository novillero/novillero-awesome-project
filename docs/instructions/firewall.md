---
tags:
  - manuals
  - portfolio
---

# Настройка файрвола в RedHat Linux  

Чтобы настроить файрвол в RedHat Linux, воспользуйтесь утилитой `iptables`.

Создайте набор правил, по которым будет контролироваться входящий, исходящий и проходящий трафики сетевых пакетов. 
Правила входят в цепочки: 
- INPUT (все входящие пакеты);
- OUTPUT (все исходящие пакеты);
- FORWARD (все проходящие пакеты, не предназначенные этому серверу).

Для каждого правила определяется действие:

- ACCEPT — разрешить пакет;
- DROP — выбросить пакет без уведомления отправителя;
- REJECT — отказать в прохождении пакета с уведомлением отправителя.

1. Перед созданием набора правил определите политики цепочек по умолчанию.
    Выполните последовательно команды:

    ```
    iptables -p INPUT ACCEPT
    iptables -p OUTPUT ACCEPT
    iptables -p FORWARD ACCEPT
    ```

    Пакеты, которые не попадают ни под одно из правил, по умолчанию будут пропускаться файрволом.

2. Создайте правило, которое разрешает уже установленные соединения:

    ```
    iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
    ```

    `-A` обозначает добавление нового правила;
    `-j` — ключ для указания действия.

3. Создайте правила, которые разрешают icmp-пакеты с типами ICMP сообщений `Echo` и `Time exceeded`

    ```
    iptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT
    ```

    ```
    iptables -A INPUT -p icmp --icmp-type 11 -j ACCEPT
    ```

    `-p` — ключ для указания типа протокола. Возможные типы протоколов: `icmp`, `tcp`, `udp`.

4. Создайте правило, которое разрешает трафик через локальный loopback интерфейс (127.0.0.1):

    ```
    iptables -A INPUT -i lo -j ACCEPT
    ```

    `-i` — входной сетевой интерфейс.

5. Создайте правило, которое разрешает сервер SSH на порту 22 для адреса `100.100.100.100`:

    ```
    iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -s 100.100.100.100 -j ACCEPT
    ```

    `state` — критерий, который позволяет получить информацию о признаке состояния соединения. `state` необходимо загрузить явно с помощью ключа`-m`;
    `-s` — ключ для указания адреса отправителя пакета.

6. Создайте правило, которое разрешает UDP-пакеты в статусе «New» для адреса `192.168.0.0/16`:

    ```
    -A INPUT -m state --state NEW -m udp -p udp -s 192.168.0.0/16 -j ACCEPT
    ```

7. Создайте правило, которое разрешает TCP-пакеты в статусе «New» для адреса `192.168.0.0/16`:

    ```
    -A INPUT -m state --state NEW -m tcp -p tcp -s 192.168.0.0/16 -j ACCEPT
    ```

8. Создайте правило, которое разрешает UDP-пакеты в статусе «New» для адреса `192.168.0.0/16`:

    ```
    -A INPUT -m state --state NEW -m udp -p udp -s 192.168.0.0/16 -j ACCEPT
    ```

9. Создайте правило, которое отклоняет все остальные входящие пакеты с icmp-сообщением `host-prohibited`:

    ```
    -A INPUT -j REJECT --reject-with icmp-host-prohibited
    ```

10. Создайте правило, которое отклоняет все проходящие через сервер пакеты с icmp-сообщением `host-prohibited`:

    ```
    -A FORWARD -j REJECT --reject-with icmp-host-prohibited
    ```

11. При каждом обновлении iptables добавленные правила будут удаляться. Чтобы избежать этого, сохраните созданный вами набор правил в файл `etc/iptables.rules`:

    ```
    iptables-save > /etc/iptables.rules
    ```

    Чтобы снова добавить вашие правила после перезагрузки сервера, выполните команду:

    ```
    iptables-restore < /etc/iptables.rules
    ```

